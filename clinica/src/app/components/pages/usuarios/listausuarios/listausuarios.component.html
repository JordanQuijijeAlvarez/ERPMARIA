<!-- Header Section -->
<div class="usuarios-container">
  <!-- Title and Actions Bar -->
  <div class="card usuarios-header">
    <div class="card__header">
      <h2 class="card__title">
        GESTIÓN DE USUARIOS
      </h2>
      <p class="card__subtitle">Administre los usuarios y roles registrados en el sistema</p>
    </div>
    
    <!-- Search and Actions -->
    <div class="usuarios-header__search">
      <!-- Search Input -->
      <div class="search-box">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (input)="onSearch($any($event.target).value)"
          placeholder="Buscar usuario por nombre o rol..."
          class="search-box__input"
        />
        <div class="search-box__icon">
          <i class="fas fa-search"></i>
        </div>
        
        <!-- Clear search button -->
        <button
          *ngIf="isSearching"
          type="button"
          (click)="clearSearch()"
          title="Limpiar búsqueda"
          class="search-box__clear"
        >
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Users Table -->
  <div class="table-container usuarios-table">
    <div class="table-header">
      <div class="usuarios-table__header">
        <h3 class="table-header__title">
          <i class="fas fa-users"></i>
          Usuarios Registrados
        </h3>
        
        <!-- Search indicator -->
        <div *ngIf="isSearching" class="badge badge--info">
          <i class="fas fa-search"></i>
          <span>{{ filteredUsuarios.length }} resultado(s) para "{{ searchTerm }}"</span>
          <button 
            (click)="clearSearch()"
            title="Limpiar búsqueda"
            class="search-box__clear usuarios-search-badge"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      
      <!-- New User Button -->
      <a routerLink="../crearUsuario">
        <button type="button" class="btn btn--primary">
          <i class="fas fa-user-plus"></i>
          <span>Nuevo Usuario</span>
        </button>
      </a>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button
        (click)="cambiarTab(1)"
        [class.active]="estadoActual === 1"
        class="tabs__button"
      >
        <i class="fas fa-check-circle"></i> Activos
      </button>
      <button
        (click)="cambiarTab(0)"
        [class.active]="estadoActual === 0"
        class="tabs__button"
      >
        <i class="fas fa-ban"></i> Inactivos
      </button>
    </div>

    
    <div>
      <table class="table">
          <thead>
            <tr>
              <th>
                <div class="usuarios-table__col-icon">
                  <i class="fas fa-user"></i>
                  Usuario
                </div>
              </th>
              <th>
                <div class="usuarios-table__col-icon">
                  <i class="fas fa-shield-alt"></i>
                  Rol
                </div>
              </th>
              <th class="usuarios-table__header-center">
                <div class="usuarios-table__col-icon usuarios-table__col-icon--center">
                  <i class="fas fa-cogs"></i>
                  Acciones
                </div>
              </th>
            </tr>
          </thead>
          <tbody>
            <!-- No results message -->
            <tr *ngIf="paginatedUsuarios.length === 0">
              <td colspan="3">
                <div class="table__empty">
                  <div class="table__empty-icon">
                    <i class="fas fa-inbox" *ngIf="!isSearching"></i>
                    <i class="fas fa-search" *ngIf="isSearching"></i>
                  </div>
                  <div>
                    <p *ngIf="isSearching"><strong>No se encontraron usuarios</strong></p>
                    <p *ngIf="!isSearching"><strong>No hay usuarios registrados</strong></p>
                    <p>
                      {{ estadoActual === 1 ? 'No hay usuarios activos en el sistema' : 'No hay usuarios inactivos' }}
                    </p>
                  </div>
                </div>
              </td>
            </tr>

            <!-- User rows -->
            <tr *ngFor="let usuarios of paginatedUsuarios">
              <td>
                <div class="usuarios-user">
                  <div class="usuarios-user__avatar-wrapper">
                    <div class="usuarios-user__avatar">
                      <span class="usuarios-user__avatar-text">{{
                        getUserInitials(usuarios.user_username)
                      }}</span>
                    </div>
                  </div>
                  <div>
                    <div class="usuarios-user__name">
                      {{ usuarios.user_username }}
                    </div>
                  </div>
                </div>
              </td>
              <td>
                <span class="badge" [class]="getRoleBadgeColor(usuarios.rol_nombre)">
                  <ng-container [ngSwitch]="usuarios.rol_nombre">
                    <i
                      *ngSwitchCase="'administrador'"
                      class="fas fa-shield-alt"
                    ></i>
                    <i
                      *ngSwitchCase="'medico'"
                      class="fas fa-user-md"
                    ></i>
                    <i
                      *ngSwitchCase="'recepcionista'"
                      class="fas fa-concierge-bell"
                    ></i>
                    <i *ngSwitchDefault class="fas fa-user"></i>
                  </ng-container>
                  {{ usuarios.rol_nombre}}
                </span>
              </td>
              <td>
                <div class="table__actions">
                  <ng-container *ngIf="estadoActual === 1">
                    <!-- Delete Button -->
                    <button
                      (click)="
                        eliminarUsuario(usuarios.user_id, usuarios.user_username)
                      "
                      type="button"
                      class="btn btn--danger btn--icon"
                      title="Eliminar usuario"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </ng-container>

                  <!-- Inactive indicator -->
                  <span *ngIf="estadoActual === 0" class="badge badge--danger">
                    Inactivo
                  </span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination Section -->
      <div class="pagination" *ngIf="totalItems > 0">
        <div class="pagination__info">
          <!-- Results info y selector de items por página -->
          <div class="pagination__text">
            Mostrando
            <span class="pagination__info-highlight">{{ getItemRange().start }}-{{ getItemRange().end }}</span>
            de <span class="pagination__info-highlight">{{ totalItems }}</span> usuarios
          </div>

          <!-- Selector de items por página -->
          <div class="pagination__select-wrapper">
            <label for="itemsPerPage">Mostrar:</label>
            <select
              id="itemsPerPage"
              (change)="changeItemsPerPage(+$any($event.target).value)"
              [value]="itemsPerPage"
              class="pagination__select"
            >
              <option value="5">5</option>
              <option value="10">10</option>
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
            <span>por página</span>
          </div>
        </div>

        <!-- Pagination controls -->
        <div class="pagination__controls">
          <button
            type="button"
            (click)="previousPage()"
            [disabled]="currentPage === 1"
            class="pagination__button"
          >
            <i class="fas fa-chevron-left"></i>
            Anterior
          </button>

          <div class="pagination__numbers">
            <button
              *ngFor="let page of getPageNumbers()"
              type="button"
              (click)="goToPage(page)"
              [class]="
                page === currentPage
                  ? 'pagination__number pagination__number--active'
                  : 'pagination__number'
              "
            >
              {{ page }}
            </button>

            <!-- Ellipsis for large page counts -->
            <span *ngIf="totalPages > 5 && currentPage < totalPages - 2" class="pagination__ellipsis">...</span>
          </div>

          <button
            type="button"
            (click)="nextPage()"
            [disabled]="currentPage === totalPages"
            class="pagination__button"
          >
            Siguiente
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

<!-- Modal comentado para referencia futura -->
<!-- 
<div data-dialog-backdrop="dialog" data-dialog-backdrop-close="true">
  <div data-dialog="dialog">
    <div>
      <h4>Edit Member Details</h4>
      <p>Enter or reset each information for the member access.</p>
    </div>
  </div>
</div> 
-->
