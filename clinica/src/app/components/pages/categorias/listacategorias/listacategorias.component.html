<div class="categorias">
  <div class="card categorias-header">
    <div class="card__header">
      <h2 class="card__title">
        GESTIÓN DE CATEGORÍAS
      </h2>
      <p class="card__subtitle">Administre las categorías de productos registradas en el sistema</p>
    </div>
    
    <!-- Search and Actions -->
    <div class="categorias-header__search">
      <!-- Search Input -->
      <div class="search-box">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (input)="onSearch($any($event.target).value)"
          placeholder="Buscar por nombre o descripción..."
          class="search-box__input"
        />
        <div class="search-box__icon">
          <i class="fas fa-search"></i>
        </div>
        
        <!-- Clear search button -->
        <button
          *ngIf="isSearching"
          type="button"
          (click)="clearSearch()"
          title="Limpiar búsqueda"
          class="search-box__clear"
        >
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Categories Table -->
  <div class="table-container categorias-table">
    <div class="table-header">
      <div class="categorias-table__header">
        <h3 class="table-header__title">
          <i class="fas fa-layer-group"></i>
          Categorías Registradas
        </h3>
        
        <!-- Search indicator -->
        <div *ngIf="isSearching" class="badge badge--info">
          <i class="fas fa-search"></i>
          <span>{{ filteredCategorias.length }} resultado(s) para "{{ searchTerm }}"</span>
          <button 
            (click)="clearSearch()"
            title="Limpiar búsqueda"
            class="search-box__clear categorias-search-badge"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      
      <!-- New Category Button -->
      <a routerLink="../crearCategoria">
        <button
          type="button"
          class="btn btn--primary"
        >
          <i class="fas fa-plus-circle"></i>
          <span>Nueva Categoría</span>
        </button>
      </a>
    </div>
      
    <div>
      <table class="table">
        <thead>
          <tr>
            <th>
              <div class="table__header-cell">
                <i class="fas fa-tag"></i>
                Nombre
              </div>
            </th>
            <th>
              <div class="table__header-cell">
                <i class="fas fa-align-left"></i>
                Descripción
              </div>
            </th>
            <th>
              <div class="table__header-cell">
                <i class="fas fa-calendar-alt"></i>
                Fecha Registro
              </div>
            </th>
            <th>
              <div class="table__header-cell">
                <i class="fas fa-cogs"></i>
                Acciones
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
            <!-- No results message -->
            <tr *ngIf="filteredCategorias.length === 0">
              <td colspan="4">
                <div class="table__empty">
                  <div class="table__empty-icon">
                    <i class="fas fa-search" *ngIf="isSearching"></i>
                    <i class="fas fa-folder-open" *ngIf="!isSearching"></i>
                  </div>
                  <div>
                    <p *ngIf="isSearching"><strong>No se encontraron categorías</strong></p>
                    <p *ngIf="!isSearching"><strong>No hay categorías registradas</strong></p>
                    <p *ngIf="isSearching">
                      No hay registros que coincidan con "{{ searchTerm }}"
                    </p>
                    <p *ngIf="!isSearching">
                      Comience agregando una nueva categoría al sistema
                    </p>
                  </div>
                  <button 
                    *ngIf="isSearching"
                    (click)="clearSearch()"
                    class="btn btn--outline btn--sm categorias-table__empty-button"
                  >
                    <i class="fas fa-times"></i>
                    Limpiar búsqueda
                  </button>
                </div>
              </td>
            </tr>
            
            <!-- Category rows -->
            <tr *ngFor="let categoria of paginatedCategorias">
              <td>
                <div class="categorias-table__row-info">
                  <div class="categorias-table__row-icon">
                    <i class="fas fa-tag"></i>
                  </div>
                  <div>
                    <div>{{ categoria.cat_nombre }}</div>
                  </div>
                </div>
              </td>
              
              <td title="{{ categoria.cat_descripcion }}">
                {{ categoria.cat_descripcion || 'Sin descripción' }}
              </td>

              <td>
                <div class="categorias-table__row-info">
                   <i class="far fa-calendar"></i>
                   {{ categoria.cat_id | date:'dd/MM/yyyy' }}
                </div>
              </td>

              <td>
                <div class="table__actions">
                  <!-- Edit Button -->
                  <button
                    (click)="ActualizarCategoria(categoria.cat_id)"
                    type="button"
                    title="Editar categoría"
                    class="btn btn--warning btn--sm btn--icon"
                  >
                    <i class="fas fa-pen"></i>
                  </button>
                  
                  <!-- Delete Button -->
                  <button
                    (click)="eliminarCategoria(categoria.cat_id, categoria.cat_nombre)"
                    type="button"
                    title="Eliminar categoría"
                    class="btn btn--danger btn--sm btn--icon"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
    <!-- Pagination Section -->
    <div *ngIf="totalItems > 0" class="pagination">
      <!-- Results info y selector de items por página -->
      <div class="pagination__info">
        <div class="pagination__text">
          Mostrando <span>{{ getItemRange().start }}-{{ getItemRange().end }}</span> de <span>{{ totalItems }}</span> categorías
        </div>
        
        <!-- Selector de items por página -->
        <div class="pagination__select-wrapper">
          <label for="itemsPerPage">Mostrar:</label>
          <select 
            id="itemsPerPage"
            (change)="changeItemsPerPage(+$any($event.target).value)"
            [value]="itemsPerPage"
            class="pagination__select"
          >
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
          <span>por página</span>
        </div>
      </div>
      
      <!-- Pagination controls -->
      <div class="pagination__controls">
        <button
          type="button"
          (click)="previousPage()"
          [disabled]="currentPage === 1"
          class="pagination__button"
        >
          <i class="fas fa-chevron-left"></i>
          Anterior
        </button>
        
        <div class="pagination__numbers">
          <button
            *ngFor="let page of getPageNumbers()"
            type="button"
            (click)="goToPage(page)"
            [class.pagination__number--active]="page === currentPage"
            class="pagination__number"
          >
            {{ page }}
          </button>
          
          <!-- Ellipsis for large page counts -->
          <span *ngIf="totalPages > 5 && currentPage < totalPages - 2">...</span>
        </div>
        
        <button
          type="button"
          (click)="nextPage()"
          [disabled]="currentPage === totalPages"
          class="pagination__button"
        >
          Siguiente
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>